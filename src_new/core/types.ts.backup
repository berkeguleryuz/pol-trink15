/**
 * CORE TYPES - Tüm sistem tipleri
 * Max 150 satır - Sadece tip tanımları
 */

// ===== MATCH TYPES =====

export enum MatchStatus {
  UPCOMING = 'upcoming',    // 30+ dakika var
  SOON = 'soon',           // 0-30 dakika kaldı
  LIVE = 'live',           // Maç canlı
  FINISHED = 'finished'    // Maç bitti
}

export enum MatchPhase {
  PRE_MATCH = 'pre_match',      // -10 ila 0 dakika
  EARLY = 'early',              // 0-15 dakika
  MID_GAME = 'mid_game',        // 15-70 dakika
  CRITICAL = 'critical',        // 70-85 dakika
  ULTRA_CRITICAL = 'ultra_critical', // 85+ dakika
  POST_MATCH = 'post_match'     // Maç sonrası kontrol
}

export interface FootballMatch {
  id: string;
  slug: string;
  title: string;
  endDate: string;              // UTC ISO string
  matchDate: string;            // YYYY-MM-DD
  kickoffTime: string;          // Berlin time (UTC+1)
  kickoffUTC: string;           // UTC ISO string
  status: MatchStatus;
  minutesUntilKickoff?: number;
  volume24hr?: number;
  liquidity?: number;
  sport: string;                // EPL, UEL, LAL, etc.
  
  // Live data (populated during match)
  homeTeam?: string;
  awayTeam?: string;
  homeScore?: number;
  awayScore?: number;
  currentMinute?: number;
  apiFootballId?: number;
}

export interface MatchPhaseInfo {
  phase: MatchPhase;
  interval: number;      // Polling interval (seconds)
  reason: string;
}

// ===== TRADING TYPES =====

export enum TradeAction {
  BUY = 'BUY',
  SELL = 'SELL',
  HOLD = 'HOLD'
}

export enum PositionType {
  TEAM_WINS_YES = 'TEAM_WINS_YES',     // Gol atan takım KAZANIR (YES)
  OPPONENT_WINS_NO = 'OPPONENT_WINS_NO', // Karşı takım KAZANIR (NO)
  DRAW_NO = 'DRAW_NO'                  // BERABERE (NO)
}

export interface Position {
  id: string;                  // Unique ID
  matchId: string;             // Football match ID
  market: string;              // Polymarket market slug
  conditionId: string;         // Polymarket condition ID
  tokenId: string;             // Polymarket token ID
  type: PositionType;          // Position type
  outcome: 'YES' | 'NO';       // Bet on YES or NO
  side: 'BUY' | 'SELL';        // Buy or Sell
  shares: number;              // Number of shares
  amount: number;              // USD spent
  avgEntryPrice: number;       // Average entry price (0-1)
  currentPrice: number;        // Current market price (0-1)
  unrealizedPnL: number;       // Current profit/loss ($)
  unrealizedPnLPercent: number; // Current profit/loss (%)
  openTime: Date;              // When position opened
  closeTime?: Date;            // When position closed
  status: 'OPEN' | 'CLOSED';   // Position status
}

export interface TradeDecision {
  action: TradeAction;
  positions: PositionType[];   // Position types to open/close
  reason: string;
  confidence: number;          // 0-1
}

export interface Trade {
  id: string;
  matchId: string;
  positionId: string;
  market: string;
  tokenId: string;
  side: 'BUY' | 'SELL';
  outcome: 'YES' | 'NO';
  shares: number;
  amount: number;              // USD
  price: number;               // Execution price (0-1)
  orderId?: string;            // Polymarket order ID
  timestamp: Date;
  success: boolean;
  error?: string;
}

export interface ExitStrategy {
  targetProfitPercent: number; // % profit to trigger sell
  sellPercent: number;         // % of position to sell
}

// Kademeli satış hedefleri (.clinerules'dan)
export const EXIT_TARGETS: ExitStrategy[] = [
  { targetProfitPercent: 50, sellPercent: 25 },  // 50% kar → %25 sat
  { targetProfitPercent: 100, sellPercent: 35 }, // 100% kar → %35 sat
  { targetProfitPercent: 200, sellPercent: 40 }, // 200% kar → %40 sat
];

export interface TradeDecision {
  action: TradeAction;
  positions: PositionType[];         // Hangi pozisyonlar açılacak
  amount: number;                    // Her pozisyon için USDC
  reason: string;
}

export interface ExitDecision {
  action: 'PARTIAL' | 'FULL' | 'HOLD';
  percentage: number;                // Satış yüzdesi
  reason: string;
}

// ===== TRADING TYPES =====

export enum PositionType {
  TEAM_WINS_YES = 'TEAM_WINS_YES',     // Gol atan takım KAZANIR (YES)
  OPPONENT_WINS_NO = 'OPPONENT_WINS_NO', // Karşı takım KAZANIR (NO)
  DRAW_NO = 'DRAW_NO'                  // BERABERE (NO)
}

export interface Position {
  id: string;                  // Unique ID
  matchId: string;             // Football match ID
  market: string;              // Polymarket market slug
  conditionId: string;         // Polymarket condition ID
  tokenId: string;             // Polymarket token ID
  type: PositionType;          // Position type
  outcome: 'YES' | 'NO';       // Bet on YES or NO
  side: 'BUY' | 'SELL';        // Buy or Sell
  shares: number;              // Number of shares
  amount: number;              // USD spent
  avgEntryPrice: number;       // Average entry price (0-1)
  currentPrice: number;        // Current market price (0-1)
  unrealizedPnL: number;       // Current profit/loss ($)
  unrealizedPnLPercent: number; // Current profit/loss (%)
  openTime: Date;              // When position opened
  closeTime?: Date;            // When position closed
  status: 'OPEN' | 'CLOSED';   // Position status
}

export interface TradeDecision {
  action: TradeAction;
  positions: Position[];       // Positions to open/close
  reason: string;
  confidence: number;          // 0-1
}

export interface Trade {
  id: string;
  matchId: string;
  positionId: string;
  market: string;
  tokenId: string;
  side: 'BUY' | 'SELL';
  outcome: 'YES' | 'NO';
  shares: number;
  amount: number;              // USD
  price: number;               // Execution price (0-1)
  orderId?: string;            // Polymarket order ID
  timestamp: Date;
  success: boolean;
  error?: string;
}

export interface ExitStrategy {
  targetProfitPercent: number; // % profit to trigger sell
  sellPercent: number;         // % of position to sell
}

// Kademeli satış hedefleri (.clinerules'dan)
export const EXIT_TARGETS: ExitStrategy[] = [
  { targetProfitPercent: 50, sellPercent: 25 },  // 50% kar → %25 sat
  { targetProfitPercent: 100, sellPercent: 35 }, // 100% kar → %35 sat
  { targetProfitPercent: 200, sellPercent: 40 }, // 200% kar → %40 sat
];

// ===== GOL EVENT =====

export interface GoalEvent {
  matchId: string;
  team: 'home' | 'away';
  minute: number;
  scorer: string;
  newScore: {
    home: number;
    away: number;
  };
  previousScore: {
    home: number;
    away: number;
  };
  timestamp: Date;
}

// ===== PRE-MATCH ANALYSIS =====

export interface PreMatchAnalysis {
  matchId: string;
  favorite: 'home' | 'away' | 'none';
  confidence: 'LOW' | 'MEDIUM' | 'HIGH';
  odds: {
    home: number;
    away: number;
    draw: number;
  };
  recommendation: 'BUY' | 'SKIP';
  reason: string;
}

// ===== NOTIFICATION TYPES =====

export interface TelegramNotification {
  type: 'MATCH_STARTING' | 'GOAL' | 'TRADE_EXECUTED' | 'POSITION_CLOSED' | 'FAVORITE_DETECTED';
  matchId: string;
  message: string;
  requiresApproval?: boolean;
  timestamp: Date;
}

// ===== CONFIGURATION =====

export interface BotConfig {
  dryRun: boolean;
  maxConcurrentMatches: number;      // Max 20-50
  updateInterval: number;            // Maç listesi güncelleme (saat)
  cleanupDelay: number;              // Bitmiş maçları temizleme (saat)
  
  trading: {
    maxPositionSize: number;         // USDC
    maxDailyLoss: number;            // USDC
    minLiquidity: number;            // Min $5000
  };
  
  monitoring: {
    soonThreshold: number;           // 30 dakika
    liveInterval: {
      early: number;                 // 2 saniye
      midGame: number;               // 2 saniye
      critical: number;              // 1 saniye
      ultraCritical: number;         // 1 saniye
    };
  };
}

// ===== SYSTEM STATE =====

export interface SystemState {
  allMatches: FootballMatch[];        // Sistemdeki tüm maçlar
  todayMatches: FootballMatch[];      // Bugün oynanan maçlar
  upcomingMatches: FootballMatch[];   // Henüz başlamamış maçlar (30+ dk)
  soonMatches: FootballMatch[];       // Yakında başlayacak maçlar (0-30 dk)
  activeMatches: FootballMatch[];     // Aktif takip edilen maçlar (SOON + LIVE)
  liveMatches: FootballMatch[];       // Canlı oynanan maçlar
  finishedMatches: FootballMatch[];   // Bitmiş maçlar
  positions: Position[];
  dailyPnL: number;
  totalTrades: number;
  lastUpdate: Date;
}
